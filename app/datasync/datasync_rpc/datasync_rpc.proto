syntax = "proto3";

package datasync_rpc;
option go_package = "./types/datasync_rpc";

// 获取同步游标请求
message GetSyncCursorReq {
  string userId = 1;     // 用户ID
  string deviceId = 2;    // 设备ID（多端支持）
  string dataType = 3;    // 数据类型：users/friends/friend_verify/groups/group_members/group_join_requests/chat_messages/chat_datasync/chat_conversation_settings
  string conversationId = 4; // 会话ID：当 dataType == "chat_messages" 且按会话拉取时可填；全局拉取可留空
  int64 clientLast = 5;     // 客户端最后的游标/版本（消息为 seq，其它为 version）。客户端带上，服务端聚合各业务的最新值
}

// 获取同步游标响应
message GetSyncCursorRes {
  int64 serverLatest = 1;  // 服务器当前该数据类型的最新 seq/version（来自各业务RPC，如 chat_rpc）
}



// 数据同步服务
service Datasync {
  // 获取同步游标
  rpc GetSyncCursor(GetSyncCursorReq) returns(GetSyncCursorRes);
}


// goctl rpc protoc datasync_rpc.proto --go_out=./types --go-grpc_out=./types --zrpc_out=.