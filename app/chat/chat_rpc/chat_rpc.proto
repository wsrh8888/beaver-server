syntax = "proto3"; //指定proto版本
package chat_rpc;

option go_package = "./chat_rpc";


// 定义TextMsg消息
message TextMsg {
  string content = 1; // 文本消息内容
}

// 定义ImageMsg消息
message ImageMsg {
  string fileKey = 1; // 图片文件ID
  int32 width = 2;    // 图片宽度（可选）
  int32 height = 3;   // 图片高度（可选）
  int64 size = 4;     // 文件大小（字节，可选）
}

// 定义VideoMsg消息
message VideoMsg {
  string fileKey = 1;      // 视频文件ID
  int32 width = 2;         // 视频宽度（可选）
  int32 height = 3;        // 视频高度（可选）
  int32 duration = 4;      // 视频时长（秒，可选）
  string thumbnailKey = 5; // 视频封面图文件ID（可选）
  int64 size = 6;          // 文件大小（字节，可选）
}

// 定义FileMsg消息
message FileMsg {
  string fileKey = 1;  // 文件ID
  string fileName = 2; // 原始文件名（可选，用于显示）
  int64 size = 3;      // 文件大小（字节，可选）
  string mimeType = 4; // MIME类型（可选，如 application/pdf）
}

// 定义VoiceMsg消息
message VoiceMsg {
  string fileKey = 1;   // 语音文件ID
  int32 duration = 2;   // 语音时长（秒，可选）
  int64 size = 3;       // 文件大小（字节，可选）
}

// 定义AudioFileMsg消息 - 音频文件消息
message AudioFileMsg {
  string fileKey = 1;  // 音频文件ID
  string fileName = 2; // 原始文件名（可选，用于显示）
  int32 duration = 3;  // 音频时长（秒，可选）
  int64 size = 4;      // 文件大小（字节，可选）
}

// 定义EmojiMsg消息 - 表情相关消息
message EmojiMsg {
  string fileKey = 1; // 表情图片文件ID（Emoji.FileName）
  uint32 emojiId = 2; // 表情ID（Emoji.ID，单个表情时使用）
  uint32 packageId = 3; // 表情包ID（EmojiPackage.ID，表情包分享时使用）
}

// 定义NotificationMsg消息 - 通知消息（会话内的通知，如：xxx加入了群聊、xxx创建了群、添加好友成功等）
message NotificationMsg {
  int32 type = 1;         // 通知类型：1=好友欢迎 2=创建群 3=加入群 4=退出群 5=踢出成员 6=转让群主等
  repeated string actors = 2; // 相关用户ID列表
}

// 定义Msg消息
message Msg {
  uint32 type = 1; // 消息类型 1:文本 2:图片 3:视频 4:文件 5:语音 6:表情 7:通知消息 8:音频文件
  TextMsg textMsg = 2; // 文本消息
  ImageMsg imageMsg = 3; // 图片
  VideoMsg videoMsg = 4; // 视频
  FileMsg fileMsg = 5; // 文件
  VoiceMsg voiceMsg = 6; // 语音（移动端录制的短语音）
  EmojiMsg emojiMsg = 7; // 表情（单个表情或表情包）
  NotificationMsg notificationMsg = 8; // 通知消息（会话内的通知，如：xxx加入了群聊、xxx创建了群等）
  AudioFileMsg audioFileMsg = 9; // 音频文件（用户上传的音频文件）
}

// 定义SendMsgReq消息
message SendMsgReq {
  string userId = 1; // 用户ID
  string conversation_id = 2; // 会话ID
  string message_id = 3; // 客户端消息ID
  Msg msg = 4; // 消息内容
  string deviceId = 5;
}

// 定义Sender消息
message Sender {
  string userId = 1;
  string avatar = 2;
  string nickName = 3;
}

// 定义SendMsgRes消息
message SendMsgRes {
  uint32 id = 1; // 数据库自增ID
  string message_id = 2; // 客户端消息ID
  string conversation_id = 3; // 会话ID
  Msg msg = 4; // 消息内容
  Sender sender = 5; // 发送者
  string create_at = 6; // 消息时间
  string msg_preview = 7; // 消息预览
  uint32 status = 8; // 消息状态 1:正常 2:已撤回 3:已编辑
  int64 seq = 9; // 消息序列号，用于数据同步
  uint32 conversation_type = 10; // 会话类型 1:私聊 2:群聊
}

// 定义UpdateConversationReq消息
message UpdateConversationReq {
  string conversation_id = 1; // 会话ID
  string user_id = 2; // 用户ID
  string last_message = 3; // 最后一条消息
  bool is_pinned = 4; // 是否置顶
  bool is_deleted = 5; // 是否已删除
}

// 定义UpdateConversationRes消息
message UpdateConversationRes {
  bool success = 1; // 是否成功
}

// 定义BatchUpdateConversationReq消息
message BatchUpdateConversationReq {
  string conversation_id = 1; // 会话ID
  repeated string user_ids = 2; // 用户ID列表
  string last_message = 3; // 最后一条消息
}

// 定义BatchUpdateConversationRes消息
message BatchUpdateConversationRes {
  bool success = 1; // 是否成功
}




// 定义GetUserConversationsReq消息 - 获取用户参与的会话列表
message GetUserConversationsReq {
  string userId = 1; // 用户ID
}

// 定义ConversationItem消息 - 会话信息
message ConversationItem {
  string conversationId = 1; // 会话ID
  int32 type = 2; // 会话类型 1=私聊 2=群聊
}

// 定义GetUserConversationsRes消息
message GetUserConversationsRes {
  repeated ConversationItem conversations = 1; // 用户参与的会话列表
}

// 定义GetConversationsListByIdsReq消息 - 批量获取会话版本信息（类似group的GetGroupsListByIds）
message GetConversationsListByIdsReq {
  repeated string conversationIds = 1; // 会话ID列表
  int64 since = 2; // 从这个版本号之后获取变更的记录
}

// 定义ConversationListById消息 - 会话版本信息
message ConversationListById {
  string conversationId = 1; // 会话ID
  int32 type = 2; // 会话类型 1=私聊 2=群聊
  int64 seq = 3; // 最新消息序列号
  int64 version = 4; // 会话元信息版本号
}

// 定义GetConversationsListByIdsRes消息
message GetConversationsListByIdsRes {
  repeated ConversationListById conversations = 1; // 会话版本信息列表
}

// 定义GetUserConversationSettingsListByIdsReq消息 - 批量获取用户会话设置版本信息
message GetUserConversationSettingsListByIdsReq {
  string userId = 1; // 用户ID
  repeated string conversationIds = 2; // 会话ID列表
  int64 since = 3; // 从这个版本号之后获取变更的记录
}

// 定义UserConversationSettingListById消息 - 用户会话设置版本信息
message UserConversationSettingListById {
  string conversationId = 1; // 会话ID
  int64 version = 2; // 用户会话设置版本号
}

// 定义GetUserConversationSettingsListByIdsRes消息
message GetUserConversationSettingsListByIdsRes {
  repeated UserConversationSettingListById userConversationSettings = 1; // 用户会话设置版本信息列表
}

// 定义InitializeConversationReq消息 - 通用会话初始化
message InitializeConversationReq {
  string conversationId = 1;    // 会话ID（调用方生成）
  int32 type = 2;               // 会话类型: 1=私聊 2=群聊 3=AI会话 4=客服会话
  repeated string userIds = 3;  // 参与用户ID列表
  map<string, int64> initialReadSeqs = 4; // 用户初始已读序列号映射，可选，用于设置特定用户的初始已读状态
}

// 定义InitializeConversationRes消息
message InitializeConversationRes {
  string conversationId = 1; // 创建的会话ID
}

// 定义SendNotificationMessageReq消息 - 发送通知消息（会话内的通知，如：xxx加入了群聊、xxx创建了群等）
message SendNotificationMessageReq {
  string conversationId = 1;    // 会话ID
  int32 messageType = 2;        // 通知消息类型: 1=好友欢迎 2=群欢迎 3=成员加入 4=成员退出
  string content = 3;           // 消息内容
  string relatedUserId = 4;     // 相关用户ID（如新加好友的ID）
}

// 定义SendNotificationMessageRes消息
message SendNotificationMessageRes {
  string messageId = 1; // 生成的消息ID
}

// 定义AddConversationMembersReq消息 - 添加会话成员
message AddConversationMembersReq {
  string conversationId = 1; // 会话ID
  repeated string userIds = 2; // 要添加的用户ID列表
}

// 定义AddConversationMembersRes消息
message AddConversationMembersRes {
  bool success = 1; // 是否成功
}

// 定义RemoveConversationMembersReq消息 - 移除会话成员
message RemoveConversationMembersReq {
  string conversationId = 1; // 会话ID
  repeated string userIds = 2; // 要移除的用户ID列表
}

// 定义RemoveConversationMembersRes消息
message RemoveConversationMembersRes {
  bool success = 1; // 是否成功
}

// 定义DissolveConversationReq消息 - 解散会话
message DissolveConversationReq {
  string conversationId = 1; // 会话ID
}

// 定义DissolveConversationRes消息
message DissolveConversationRes {
  bool success = 1; // 是否成功
}

// 定义GetUserConversationVersionsReq消息 - 获取用户会话设置版本信息
message GetUserConversationVersionsReq {
  string userId = 1; // 用户ID
  int64 since = 2;   // 从这个版本号之后开始同步
}

// 定义UserConversationVersion消息
message UserConversationVersion {
  string conversationId = 1; // 会话ID
  int64 version = 2;         // 用户会话设置版本号
}

// 定义GetUserConversationVersionsRes消息
message GetUserConversationVersionsRes {
  repeated UserConversationVersion userConversationVersions = 1; // 用户会话设置版本列表
}

// 定义chat_rpc服务
service Chat {
    rpc SendMsg(SendMsgReq) returns (SendMsgRes); //发送消息
    rpc UpdateConversation(UpdateConversationReq) returns (UpdateConversationRes); //更新单个用户的会话记录
    rpc BatchUpdateConversation(BatchUpdateConversationReq) returns (BatchUpdateConversationRes); //批量更新会话记录
    rpc GetUserConversations(GetUserConversationsReq) returns (GetUserConversationsRes); //获取用户参与的会话列表
    rpc GetConversationsListByIds(GetConversationsListByIdsReq) returns (GetConversationsListByIdsRes); //批量获取会话版本信息
    rpc GetUserConversationSettingsListByIds(GetUserConversationSettingsListByIdsReq) returns (GetUserConversationSettingsListByIdsRes); //批量获取用户会话设置版本信息
    rpc GetUserConversationVersions(GetUserConversationVersionsReq) returns (GetUserConversationVersionsRes); //获取用户会话设置版本信息
    rpc InitializeConversation(InitializeConversationReq) returns (InitializeConversationRes); //初始化会话
    rpc AddConversationMembers(AddConversationMembersReq) returns (AddConversationMembersRes); //添加会话成员
    rpc RemoveConversationMembers(RemoveConversationMembersReq) returns (RemoveConversationMembersRes); //移除会话成员
    rpc DissolveConversation(DissolveConversationReq) returns (DissolveConversationRes); //解散会话
    rpc SendNotificationMessage(SendNotificationMessageReq) returns (SendNotificationMessageRes); //发送通知消息（会话内的通知，如：xxx加入了群聊、xxx创建了群等）
}

// goctl rpc protoc chat_rpc.proto --go_out=./types --go-grpc_out=./types --zrpc_out=.
