syntax = "proto3"; //指定proto版本
package user_rpc;

option go_package = "./user_rpc";


message UserCreateReq {
  string phone = 1;    // 手机号（与email二选一）
  string password = 2; // 密码
  int32 source = 3;    // 注册来源：1-手机号注册，2-邮箱注册
  string email = 4;    // 邮箱（与phone二选一）
  string nick_name = 5; // 昵称（可选）
}

message UserCreateRes {
  string userID = 1;
}

message UserInfoReq {
  string userID = 1;
}

message UserInfoRes {
  UserInfo user_info = 1;  // 用户信息
}
 

 message IsFriendReq {
  string user1 = 1;
  string user2 = 2;
}

message IsFriendRes {
  bool is_friend = 1;
}

message UserInfo {
  string user_id = 1;   // 用户ID
  string nick_name = 2;
  string avatar = 3;
  int64 version = 4;    // 用户版本号，用于同步
  string email = 5;
  string abstract = 6;

}

message UserListInfoReq {
  repeated string user_id_list = 1;
  int64 since_timestamp = 2; // 可选：从这个时间戳之后查询更新的用户，不传则返回所有
}

message UserListInfoRes {
  map<string, UserInfo> user_info = 1; //用户配置的json
}

message SearchUserReq {
  string keyword = 1; // 搜索关键词（邮箱或用户ID）
  string type = 2;    // 搜索类型：email 或 userId
}

message SearchUserRes {
  UserInfo user_info = 1; // 用户信息
}

service user {
  rpc UserCreate(UserCreateReq) returns(UserCreateRes); //创建用户
  rpc UserInfo(UserInfoReq) returns(UserInfoRes); // 用户信息
  rpc IsFriend(IsFriendReq) returns(IsFriendRes); //是否是好友
  rpc UserListInfo(UserListInfoReq) returns(UserListInfoRes); // 批量获取用户信息，支持增量同步
  rpc SearchUser(SearchUserReq) returns(SearchUserRes); // 根据邮箱或用户ID搜索用户
}

// goctl rpc protoc user_rpc.proto --go_out=./types --go-grpc_out=./types --zrpc_out=.